<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Easy Gift ‚Äî –∫–µ–π—Å—ã, –ø—Ä–æ—Ñ–∏–ª—å, 24—á</title>

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#1f2730;
      --bg2:#1b222b;
      --panel:#2a333d;
      --panel2:#313c47;
      --text:#e9f1fb;
      --muted:#9fb0c5;
      --accent:#2aa8ff;
      --accent2:#0f7ecb;
      --good:#17c964;
      --warn:#f5a524;
      --danger:#ff4d4d;
      --radius:18px;

      --itemW: 150px;
      --itemH: 120px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,#151b22, var(--bg) 25%, #151b22);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      padding:12px 12px 92px; /* –º–µ—Å—Ç–æ –ø–æ–¥ –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é */
    }

    .app{max-width:980px;margin:0 auto;display:flex;flex-direction:column;gap:12px;}

    /* –í–µ—Ä—Ö–Ω—è—è —à–∞–ø–∫–∞ –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–∫–µ */
    .topbar{
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.08);
      border-radius:22px;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .leftHead{display:flex;align-items:center;gap:10px;min-width:0;}
    .avatar{
      width:40px;height:40px;border-radius:50%;
      background:rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.10);
      overflow:hidden;
      flex:0 0 auto;
      display:grid;place-items:center;
      font-weight:900;
      color:var(--text);
    }
    .avatar img{width:100%;height:100%;object-fit:cover;display:block;}
    .headText{display:flex;flex-direction:column;gap:2px;min-width:0;}
    .headText b{font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .headText small{color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    .rightHead{display:flex;align-items:center;gap:10px;flex:0 0 auto;}
    .pill{
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      font-weight:900;
    }
    .starImg{
      width:18px;height:18px;object-fit:contain;display:block;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
    }
    .plusBtn{
      width:44px;height:44px;border-radius:999px;
      border:0;
      background:var(--accent);
      color:#06121b;
      font-weight:900;
      font-size:20px;
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      box-shadow:0 10px 25px rgba(42,168,255,0.20);
    }
    .plusBtn:disabled{opacity:.5;cursor:not-allowed;box-shadow:none;}

    .btn{
      border:0;
      border-radius:14px;
      padding:11px 14px;
      font-weight:900;
      background:var(--accent);
      color:#06121b;
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
    }
    .btn:disabled{opacity:.55;cursor:not-allowed;}
    .btn.secondary{
      background:rgba(255,255,255,0.06);
      color:var(--text);
      border:1px solid rgba(255,255,255,0.10);
    }
    .btn.danger{
      background:rgba(255,77,77,0.16);
      color:var(--text);
      border:1px solid rgba(255,77,77,0.35);
    }

    .card{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:22px;
      padding:12px;
    }
    .card h3{
      margin:0 0 10px 0;
      font-size:14px;
      color:rgba(233,241,251,0.85);
      font-weight:900;
      letter-spacing:.2px;
      text-transform:none;
      opacity:.9;
    }

    /* –ö–µ–π—Å—ã */
    .casesRow{
      display:flex;
      gap:10px;
      overflow:auto;
      padding-bottom:6px;
      -webkit-overflow-scrolling:touch;
      scroll-snap-type:x mandatory;
    }
    .caseCard{
      flex:0 0 240px;
      scroll-snap-align:start;
      border-radius:18px;
      background:rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
      padding:12px;
      display:flex;
      gap:12px;
      align-items:center;
      cursor:pointer;
      user-select:none;
    }
    .caseCard.active{
      border-color:rgba(42,168,255,0.85);
      box-shadow:0 0 0 4px rgba(42,168,255,0.10);
    }
    .caseArt{
      width:64px;height:64px;
      border-radius:18px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      display:grid;place-items:center;
      font-size:28px;
      flex:0 0 auto;
    }
    .caseInfo{min-width:0;display:flex;flex-direction:column;gap:6px;}
    .caseName{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .priceLine{display:flex;align-items:center;gap:6px;font-weight:900;}
    .priceLine small{color:var(--muted);font-weight:700}

    /* –†—É–ª–µ—Ç–∫–∞ */
    .rouletteWrap{display:flex;flex-direction:column;gap:10px;}
    .window{
      position:relative;
      height: var(--itemH);
      overflow:hidden;
      border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.10);
    }
    .fadeLeft, .fadeRight{
      position:absolute;top:0;bottom:0;width:44px;z-index:3;pointer-events:none;
    }
    .fadeLeft{left:0;background:linear-gradient(90deg, rgba(31,39,48,1), rgba(31,39,48,0));}
    .fadeRight{right:0;background:linear-gradient(270deg, rgba(31,39,48,1), rgba(31,39,48,0));}
    .centerLine{
      position:absolute;top:0;bottom:0;left:50%;
      width:2px;background:rgba(42,168,255,.35);z-index:2;
    }
    .pointer{
      position:absolute;
      left:50%;
      top:6px;
      transform:translateX(-50%);
      width:0;height:0;
      border-left:12px solid transparent;
      border-right:12px solid transparent;
      border-top:16px solid rgba(42,168,255,.95);
      z-index:4;
      filter:drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    .track{
      position:absolute;
      top:0;left:0;height:100%;
      display:flex;
      will-change:transform;
      transform:translateX(0px);
      z-index:1;
    }
    .item{
      width:var(--itemW);
      height:var(--itemH);
      padding:10px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:8px;
      border-right:1px solid rgba(255,255,255,0.06);
      background:rgba(0,0,0,0.03);
    }
    .item:nth-child(2n){ background:rgba(255,255,255,0.02); }
    .itemEmoji{
      width:54px;height:54px;
      border-radius:18px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      display:grid;place-items:center;
      font-size:30px;
    }
    .itemName{
      font-weight:900;
      font-size:13px;
      text-align:center;
      line-height:1.15;
      padding:0 4px;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      min-height:30px;
    }
    .itemCost{
      display:flex;align-items:center;gap:6px;
      font-weight:900;
    }

    .badge{
      font-size:12px;
      color:var(--muted);
      padding:7px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.18);
    }
    .controls{
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }
    .hint{color:var(--muted);font-size:12px;line-height:1.3;}
    .result{
      margin-top:10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.20);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .result b{font-size:14px}

    /* –ü—Ä–æ—Ñ–∏–ª—å */
    .profileHeader{
      display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;
    }
    .userBox{display:flex;flex-direction:column;gap:2px;}
    .userBox b{font-size:15px}
    .invList{display:flex;flex-direction:column;gap:8px;margin-top:10px;}
    .invItem{
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.18);
      padding:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .invLeft{display:flex;gap:10px;align-items:center;min-width:0;}
    .miniEmoji{
      width:38px;height:38px;border-radius:14px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      display:grid;place-items:center;
      font-size:20px;
      flex:0 0 auto;
    }
    .invName{
      font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:55vw;
    }
    .invMeta{color:var(--muted);font-size:12px;margin-top:2px;}
    .invRight{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end;}
    .smallPrice{
      display:flex;align-items:center;gap:6px;font-weight:900;
      white-space:nowrap;
    }
    .empty{
      padding:14px;
      border-radius:16px;
      border:1px dashed rgba(255,255,255,0.15);
      color:var(--muted);
      text-align:center;
      margin-top:10px;
      background:rgba(0,0,0,0.14);
    }

    /* –ú–æ–¥–∞–ª–∫–∞ keep/sell */
    .modalBack{
      position:fixed;inset:0;
      background:rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:999;
    }
    .modal{
      width:min(520px, 100%);
      border-radius:20px;
      background:rgba(31,39,48,0.98);
      border:1px solid rgba(255,255,255,0.10);
      box-shadow:0 20px 60px rgba(0,0,0,0.4);
      padding:14px;
    }
    .modalTop{display:flex;justify-content:space-between;align-items:center;gap:10px;}
    .modalTop b{font-size:16px}
    .closeX{cursor:pointer;color:var(--muted);font-weight:900;padding:6px 10px;border-radius:12px;}
    .closeX:hover{background:rgba(255,255,255,0.06);color:var(--text);}
    .modalBody{margin-top:10px;display:flex;gap:12px;align-items:center;}
    .bigEmoji{
      width:74px;height:74px;border-radius:22px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      display:grid;place-items:center;font-size:40px;flex:0 0 auto;
    }
    .modalActions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;}

    /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–∫–µ */
    .bottomNav{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      background:rgba(21,27,34,0.85);
      backdrop-filter: blur(10px);
      border-top:1px solid rgba(255,255,255,0.08);
      z-index:998;
    }
    .navRow{
      max-width:980px;margin:0 auto;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:6px;
    }
    .navItem{
      border-radius:16px;
      padding:10px 8px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      color:rgba(233,241,251,0.70);
      user-select:none;
      cursor:pointer;
      border:1px solid transparent;
      background:transparent;
      font-weight:800;
      font-size:11px;
    }
    .navItem .ico{font-size:18px;opacity:.9;}
    .navItem.active{
      color:var(--text);
      background:rgba(42,168,255,0.14);
      border-color:rgba(42,168,255,0.30);
    }

    /* –ê–¥–º–∏–Ω */
    .adminGrid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:10px;
    }
    .field{
      display:flex;gap:8px;align-items:center;flex-wrap:wrap;
    }
    .inp{
      flex:1 1 auto;
      min-width:160px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.18);
      color:var(--text);
      outline:none;
      font-weight:800;
    }
    .small{font-size:12px;color:var(--muted);}
  </style>
</head>

<body>
  <div class="app">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="leftHead">
        <div class="avatar" id="avatar">
          <span id="avatarFallback">EG</span>
        </div>
        <div class="headText">
          <b id="headName">Easy Gift</b>
          <small id="subTitle">–ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è‚Ä¶</small>
        </div>
      </div>

      <div class="rightHead">
        <div class="pill" title="–ë–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥">
          <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
          <span id="stars">0</span>
        </div>
        <!-- –ü–õ–Æ–° –ö–ù–û–ü–ö–ê: –æ–±—ã—á–Ω—ã–º –ª—é–¥—è–º –Ω–µ –¥–∞—ë—Ç –∑–≤—ë–∑–¥—ã -->
        <button class="plusBtn" id="plusBtn" title="–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω) / –ó–∞–≥–ª—É—à–∫–∞">+</button>
      </div>
    </div>

    <!-- PAGES -->
    <div id="page_main" class="page">
      <div class="card">
        <h3>–ö–µ–π—Å—ã</h3>
        <div class="casesRow" id="casesRow"></div>
      </div>

      <div class="card rouletteWrap">
        <h3>–õ–æ—Ç–µ—Ä–µ—è</h3>

        <div class="window" id="window">
          <div class="fadeLeft"></div>
          <div class="fadeRight"></div>
          <div class="centerLine"></div>
          <div class="pointer"></div>
          <div class="track" id="track"></div>
        </div>

        <div class="controls">
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
            <span class="badge" id="caseBadge">–ö–µ–π—Å: ‚Äî</span>
            <span class="badge" id="cooldownBadge">–î–æ—Å—Ç—É–ø–Ω–æ</span>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn secondary" id="demoBtn" title="–î–µ–º–æ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –∑–≤—ë–∑–¥—ã, –Ω–æ –ù–ï —Å—Ç–∞–≤–∏—Ç –∫–¥">–î–µ–º–æ</button>
            <button class="btn" id="spinBtn">–ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É</button>
          </div>
        </div>

        <div class="result">
          <div>
            <div class="hint">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
            <b id="resultText">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ</b>
          </div>
          <div class="hint" id="resultMeta"></div>
        </div>

      </div>
    </div>

    <div id="page_profile" class="page" style="display:none;">
      <div class="card">
        <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>

        <div class="profileHeader">
          <div class="userBox">
            <b id="userName">‚Äî</b>
            <div class="hint" id="userIdLine">‚Äî</div>
          </div>

          <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;">
            <button class="btn secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="btn danger" id="wipeBtn">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
          </div>
        </div>

        <div class="hint" style="margin-top:8px;">
          –ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è ‚Äú–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ‚Äù –ø–æ–¥–∞—Ä–∫–∏. –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –∏—Ö –∑–∞ ‚≠ê.
        </div>

        <div id="invWrap"></div>
      </div>
    </div>

    <div id="page_soon" class="page" style="display:none;">
      <div class="card">
        <h3>–°–∫–æ—Ä–æ</h3>
        <div class="empty">–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</div>
      </div>
    </div>

    <div id="page_upgrade" class="page" style="display:none;">
      <div class="card">
        <h3>–ê–ø–≥—Ä–µ–π–¥</h3>
        <div class="empty">–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</div>
      </div>
    </div>

    <div id="page_admin" class="page" style="display:none;">
      <div class="card">
        <h3>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
        <div class="small">–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è <b>@RealZanT</b></div>

        <div class="adminGrid">
          <div class="field">
            <input class="inp" id="adminSetStars" type="number" placeholder="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä 100)" />
            <button class="btn" id="adminApplyStars">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          </div>

          <div class="field">
            <button class="btn secondary" id="adminAdd10">+10 ‚≠ê</button>
            <button class="btn secondary" id="adminResetCd">–°–±—Ä–æ—Å–∏—Ç—å –ö–î 24—á</button>
            <button class="btn danger" id="adminWipeAll">–°—Ç–µ—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å (—Ç–µ–∫—É—â–∏–π)</button>
          </div>

          <div class="field">
            <button class="btn secondary" id="adminExport">–≠–∫—Å–ø–æ—Ä—Ç (JSON)</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- MODAL keep/sell -->
  <div class="modalBack" id="modalBack">
    <div class="modal">
      <div class="modalTop">
        <b>–í—ã–ø–∞–ª –ø–æ–¥–∞—Ä–æ–∫</b>
        <div class="closeX" id="modalClose">‚úï</div>
      </div>

      <div class="modalBody">
        <div class="bigEmoji" id="modalEmoji">üéÅ</div>
        <div style="min-width:0;">
          <div style="font-weight:900;font-size:14px;" id="modalName">‚Äî</div>
          <div class="hint" id="modalInfo">‚Äî</div>
          <div style="margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
            <div class="smallPrice">
              <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
              <span id="modalCost">0</span>
              <span class="hint">—Å—Ç–æ–∏–º–æ—Å—Ç—å (gift)</span>
            </div>
            <div class="smallPrice">
              <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
              <span id="modalSell">0</span>
              <span class="hint">–∑–∞ –ø—Ä–æ–¥–∞–∂—É</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modalActions">
        <button class="btn secondary" id="keepBtn">–û—Å—Ç–∞–≤–∏—Ç—å</button>
        <button class="btn" id="sellBtn">–ü—Ä–æ–¥–∞—Ç—å –∑–∞ ‚≠ê</button>
      </div>
    </div>
  </div>

  <!-- bottom nav -->
  <div class="bottomNav">
    <div class="navRow">
      <div class="navItem active" data-page="main"><div class="ico">üéÅ</div>–ì–ª–∞–≤–Ω–∞—è</div>
      <div class="navItem" data-page="main"><div class="ico">üé≤</div>–õ–æ—Ç–µ—Ä–µ—è</div>
      <div class="navItem" data-page="soon"><div class="ico">üïí</div>–°–∫–æ—Ä–æ</div>
      <div class="navItem" data-page="upgrade"><div class="ico">‚¨ÜÔ∏è</div>–ê–ø–≥—Ä–µ–π–¥</div>
      <div class="navItem" data-page="profile"><div class="ico">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
  </div>

<script>
/* ==========================
   –ù–ê–°–¢–†–û–ô–ö–ò
========================== */
const COOLDOWN_MS = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞
const SELL_RATE = 0.20; // 20% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥–∞—Ä–∫–∞ -> –≤ ‚≠ê

/* ==========================
   –ö–µ–π—Å—ã –∏ –ø—Ä–∏–∑—ã
   –í–ê–ñ–ù–û: "1 –∑–≤–µ–∑–¥–∞" -> "2 –∑–≤–µ–∑–¥—ã" –∏ cost=2
========================== */
const CASES = [
  {
    id: "case_1",
    icon: "üéÅ",
    name: "–ö–µ–π—Å –∑–∞ 1‚≠ê",
    price: 1,
    gifts: [
      {id:"g_star2", emoji:"‚≠ê", name:"2 –∑–≤–µ–∑–¥—ã", cost:2,  weight:70, isStars:true},
      {id:"g_heart", emoji:"üíù", name:"–°–µ—Ä–¥—Ü–µ",  cost:15, weight:30},
      {id:"g_lolli", emoji:"üç≠", name:"–õ–µ–¥–µ–Ω–µ—Ü", cost:560, weight:16},
      {id:"g_flwr",  emoji:"üå∏", name:"–¶–≤–µ—Ç–æ–∫",  cost:1280, weight:10},
      {id:"g_cake",  emoji:"üç∞", name:"–¢–æ—Ä—Ç",    cost:780, weight:12},
      {id:"g_potion",emoji:"üß™", name:"–ó–µ–ª—å–µ",   cost:2300, weight:4},
    ]
  },
  {
    id: "case_5",
    icon: "üß∏",
    name: "–ö–µ–π—Å –∑–∞ 5‚≠ê",
    price: 5,
    gifts: [
      {id:"g_cake2", emoji:"üç∞", name:"–¢–æ—Ä—Ç —Å –≤–∏—à–Ω–µ–π", cost:780,  weight:18},
      {id:"g_flwr2", emoji:"üå∏", name:"–¶–≤–µ—Ç–æ–∫",       cost:1280, weight:16},
      {id:"g_shoe",  emoji:"üë†", name:"–¢—É—Ñ–ª–∏",        cost:1750, weight:12},
      {id:"g_potion2",emoji:"üß™",name:"–ó–µ–ª—å–µ",        cost:2300, weight:10},
      {id:"g_rose",  emoji:"üåπ", name:"–†–æ–∑–∞ –≤ –∫–æ–ª–±–µ", cost:3500, weight:6},
      {id:"g_ring",  emoji:"üíç", name:"–ö–æ–ª—å—Ü–æ",       cost:3900, weight:4},
    ]
  },
  {
    id: "case_40",
    icon: "üíù",
    name: "–ö–µ–π—Å –∑–∞ 40‚≠ê",
    price: 40,
    gifts: [
      {id:"g_bear",  emoji:"üß∏", name:"–ú–∏—à–∫–∞",        cost:5500, weight:6},
      {id:"g_ring2", emoji:"üíç", name:"–ö–æ–ª—å—Ü–æ",       cost:3900, weight:10},
      {id:"g_rose2", emoji:"üåπ", name:"–†–æ–∑–∞ –≤ –∫–æ–ª–±–µ", cost:3500, weight:10},
      {id:"g_shoe2", emoji:"üë†", name:"–¢—É—Ñ–ª–∏",        cost:1750, weight:18},
      {id:"g_flwr3", emoji:"üå∏", name:"–¶–≤–µ—Ç–æ–∫",       cost:1280, weight:22},
      {id:"g_lolli2",emoji:"üç≠", name:"–õ–µ–¥–µ–Ω–µ—Ü",      cost:560,  weight:26},
    ]
  }
];

/* ==========================
   HELPERS
========================== */
function safeJsonParse(s, fallback){ try { return JSON.parse(s); } catch { return fallback; } }
function nowMs(){ return Date.now(); }
function fmtTimeLeft(ms){
  ms = Math.max(0, ms);
  const totalSec = Math.floor(ms/1000);
  const h = Math.floor(totalSec/3600);
  const m = Math.floor((totalSec%3600)/60);
  const s = totalSec%60;
  const pad = (x)=>String(x).padStart(2,"0");
  return `${pad(h)}:${pad(m)}:${pad(s)}`;
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }
function animate(ms, step){
  return new Promise((resolve) => {
    const start = performance.now();
    function frame(now){
      const t = clamp((now - start) / ms, 0, 1);
      step(t);
      if (t < 1) requestAnimationFrame(frame);
      else resolve();
    }
    requestAnimationFrame(frame);
  });
}

/* ==========================
   TELEGRAM USER
========================== */
function getTelegramUser(){
  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  if (!tg) return null;
  const u = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
  if (!u || !u.id) return null;

  try { tg.expand(); } catch {}

  return {
    id: String(u.id),
    username: u.username ? "@"+u.username : "",
    first_name: u.first_name || "",
    last_name: u.last_name || "",
    photo_url: u.photo_url || ""
  };
}
function ensureGuestUser(){
  const key = "eg_guest_id";
  let id = localStorage.getItem(key);
  if (!id){
    id = "guest_" + Math.random().toString(16).slice(2) + "_" + Date.now();
    localStorage.setItem(key, id);
  }
  return { id, username:"", first_name:"–ì–æ—Å—Ç—å", last_name:"", photo_url:"" };
}

let USER = null;
let IS_ADMIN = false;

function initUser(){
  const tgUser = getTelegramUser();
  USER = tgUser ? tgUser : ensureGuestUser();

  IS_ADMIN = (USER.username === "@RealZanT");

  const name = [USER.first_name, USER.last_name].filter(Boolean).join(" ").trim() || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
  const sub = tgUser
    ? `${USER.username ? USER.username + " ‚Ä¢ " : ""}${earned} –∑–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ`
    : `–í—Ö–æ–¥: –õ–æ–∫–∞–ª—å–Ω—ã–π –≥–æ—Å—Ç—å`;

  document.getElementById("headName").textContent = (USER.username || name || "Easy Gift");
  document.getElementById("subTitle").textContent = sub;
  document.getElementById("userName").textContent = `${name} ${USER.username}`.trim();
  document.getElementById("userIdLine").textContent = `ID: ${USER.id}`;

  // –∞–≤–∞—Ç–∞—Ä
  const avatar = document.getElementById("avatar");
  const fallback = document.getElementById("avatarFallback");
  if (USER.photo_url){
    fallback.style.display = "none";
    avatar.innerHTML = `<img src="${escapeHtml(USER.photo_url)}" alt="avatar">`;
  } else {
    fallback.textContent = (USER.username || name || "EG").replace("@","").slice(0,2).toUpperCase();
  }

  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  if (tg){
    try { tg.setHeaderColor("#151b22"); } catch {}
    try { tg.setBackgroundColor("#151b22"); } catch {}
  }
}

/* –∫–ª—é—á–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
function kBalance(){ return `eg_balance_${USER.id}`; }
function kInv(){ return `eg_inventory_${USER.id}`; }
function kLastSpin(){ return `eg_lastSpin_${USER.id}`; }
function kEarned(){ return `eg_earned_${USER.id}`; }

/* ==========================
   STATE
========================== */
const els = {
  stars: document.getElementById("stars"),
  plusBtn: document.getElementById("plusBtn"),
  casesRow: document.getElementById("casesRow"),
  caseBadge: document.getElementById("caseBadge"),
  cooldownBadge: document.getElementById("cooldownBadge"),
  track: document.getElementById("track"),
  window: document.getElementById("window"),
  spinBtn: document.getElementById("spinBtn"),
  demoBtn: document.getElementById("demoBtn"),
  resultText: document.getElementById("resultText"),
  resultMeta: document.getElementById("resultMeta"),
  invWrap: document.getElementById("invWrap"),
  exportBtn: document.getElementById("exportBtn"),
  wipeBtn: document.getElementById("wipeBtn"),

  modalBack: document.getElementById("modalBack"),
  modalClose: document.getElementById("modalClose"),
  modalEmoji: document.getElementById("modalEmoji"),
  modalName: document.getElementById("modalName"),
  modalInfo: document.getElementById("modalInfo"),
  modalCost: document.getElementById("modalCost"),
  modalSell: document.getElementById("modalSell"),
  keepBtn: document.getElementById("keepBtn"),
  sellBtn: document.getElementById("sellBtn"),

  // admin
  adminSetStars: document.getElementById("adminSetStars"),
  adminApplyStars: document.getElementById("adminApplyStars"),
  adminAdd10: document.getElementById("adminAdd10"),
  adminResetCd: document.getElementById("adminResetCd"),
  adminWipeAll: document.getElementById("adminWipeAll"),
  adminExport: document.getElementById("adminExport"),
};

let stars = 0;
let inventory = [];
let activeCase = CASES[0];
let isSpinning = false;
let pendingGift = null;
let earned = 0;

/* ==========================
   STORAGE
   –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: 1‚≠ê
========================== */
function loadAll(){
  const savedEarned = Number(localStorage.getItem(kEarned()));
  earned = Number.isFinite(savedEarned) ? savedEarned : 0;

  const savedBal = Number(localStorage.getItem(kBalance()));
  stars = Number.isFinite(savedBal) ? savedBal : 1;

  inventory = safeJsonParse(localStorage.getItem(kInv()), []);
  if (!Array.isArray(inventory)) inventory = [];

  updateStarsUI();
}
function saveBalance(){ localStorage.setItem(kBalance(), String(stars)); }
function saveInventory(){ localStorage.setItem(kInv(), JSON.stringify(inventory)); }
function saveEarned(){ localStorage.setItem(kEarned(), String(earned)); }

function updateStarsUI(){ els.stars.textContent = String(stars); }

/* ==========================
   NAV / PAGES
========================== */
function setPage(name){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  const el = document.getElementById("page_"+name);
  if (el) el.style.display = "";

  document.querySelectorAll(".navItem").forEach(n=>{
    const isActive = (n.dataset.page === name) || (name==="main" && n.dataset.page==="main");
    n.classList.toggle("active", isActive && (n.textContent.includes("–ì–ª–∞–≤–Ω–∞—è") || n.textContent.includes("–õ–æ—Ç–µ—Ä–µ—è") ? name==="main" : true));
  });

  if (name === "profile") renderInventory();
}
document.querySelectorAll(".navItem").forEach(n=>{
  n.addEventListener("click", ()=>{
    const pg = n.dataset.page;
    // –õ–æ—Ç–µ—Ä–µ—è –≤ —Ç–≤–æ—ë–º –¥–µ–º–æ ‚Äî —ç—Ç–æ —Ç–∞ –∂–µ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏–Ω–æ–º
    if (pg === "main") setPage("main");
    else setPage(pg);
  });
});

/* ==========================
   COOLDOWN 24—á
========================== */
function getLastSpinMs(){
  const v = Number(localStorage.getItem(kLastSpin()));
  return Number.isFinite(v) ? v : 0;
}
function setLastSpinMs(ms){ localStorage.setItem(kLastSpin(), String(ms)); }
function getCooldownLeftMs(){
  const last = getLastSpinMs();
  if (!last) return 0;
  const left = (last + COOLDOWN_MS) - nowMs();
  return Math.max(0, left);
}
function canSpinNow(){ return getCooldownLeftMs() <= 0; }
function updateCooldownUI(){
  const left = getCooldownLeftMs();
  if (left <= 0){
    els.cooldownBadge.textContent = "–î–æ—Å—Ç—É–ø–Ω–æ";
    els.spinBtn.disabled = false;
    return;
  }
  els.cooldownBadge.textContent = `–ß–µ—Ä–µ–∑ ${fmtTimeLeft(left)}`;
  els.spinBtn.disabled = true;
}
setInterval(updateCooldownUI, 500);

/* ==========================
   CASES UI (–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è)
========================== */
function renderCases(){
  els.casesRow.innerHTML = CASES.map(c => `
    <div class="caseCard ${c.id === activeCase.id ? "active" : ""}" data-id="${c.id}">
      <div class="caseArt">${escapeHtml(c.icon)}</div>
      <div class="caseInfo">
        <div class="caseName">${escapeHtml(c.name)}</div>
        <div class="priceLine">
          <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
          <span>${c.price}</span>
          <small>–∑–∞ —Å–ø–∏–Ω</small>
        </div>
      </div>
    </div>
  `).join("");

  [...els.casesRow.querySelectorAll(".caseCard")].forEach(card=>{
    card.addEventListener("click", ()=>{
      const id = card.dataset.id;
      const found = CASES.find(x=>x.id===id);
      if (!found) return;
      activeCase = found;
      renderCases();
      refreshRoulette();
    });
  });
}

function weightedPick(list){
  const total = list.reduce((s,g)=>s + (g.weight || 1), 0);
  let r = Math.random() * total;
  for (let i=0;i<list.length;i++){
    r -= (list[i].weight || 1);
    if (r <= 0) return { gift:list[i], index:i };
  }
  return { gift:list[list.length-1], index:list.length-1 };
}

function buildTrack(baseGifts){
  const repeats = 18;
  const items = [];
  for (let r=0;r<repeats;r++){
    for (const g of baseGifts) items.push(g);
  }

  els.track.innerHTML = items.map(g => `
    <div class="item">
      <div class="itemEmoji">${escapeHtml(g.emoji)}</div>
      <div class="itemName">${escapeHtml(g.name)}</div>
      <div class="itemCost">
        <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
        <span>${g.cost}</span>
      </div>
    </div>
  `).join("");

  els.track.style.transform = "translateX(0px)";
  els.track.dataset.repeats = String(repeats);
}

function getCurrentTranslateX(){
  const tr = getComputedStyle(els.track).transform;
  if (!tr || tr === "none") return 0;
  const m = tr.match(/matrix\(([^)]+)\)/);
  if (!m) return 0;
  const parts = m[1].split(",").map(x => Number(x.trim()));
  return parts[4] || 0;
}

function refreshRoulette(){
  els.caseBadge.textContent = `–ö–µ–π—Å: ${activeCase.name} ‚Ä¢ —Ü–µ–Ω–∞ ${activeCase.price}`;
  els.spinBtn.innerHTML = `–ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É ‚Äî <span style="display:inline-flex;align-items:center;gap:6px;vertical-align:middle;">
    <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
    ${activeCase.price}
  </span>`;
  buildTrack(activeCase.gifts);
  els.resultText.textContent = "–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ";
  els.resultMeta.textContent = "";
  updateCooldownUI();
}

/* ==========================
   MODAL keep/sell
========================== */
function sellItemValue(cost){
  return Math.max(1, Math.floor((Number(cost)||0) * SELL_RATE));
}
function openModal(gift, caseObj){
  pendingGift = { gift, caseObj };
  const sellValue = sellItemValue(gift.cost || 0);

  els.modalEmoji.textContent = gift.emoji || "üéÅ";
  els.modalName.textContent = gift.name || "–ü–æ–¥–∞—Ä–æ–∫";
  els.modalInfo.textContent = `–ò–∑ –∫–µ–π—Å–∞: ${caseObj.name} ‚Ä¢ –ü—Ä–æ–¥–∞–∂–∞: ${Math.round(SELL_RATE*100)}% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏`;
  els.modalCost.textContent = String(gift.cost || 0);
  els.modalSell.textContent = String(sellValue);

  els.modalBack.style.display = "flex";
}
function closeModal(){
  els.modalBack.style.display = "none";
  pendingGift = null;
}
els.modalClose.addEventListener("click", closeModal);
els.modalBack.addEventListener("click", (e)=>{ if (e.target === els.modalBack) closeModal(); });

/* ==========================
   INVENTORY
========================== */
function addToInventory(gift, caseObj){
  const item = {
    uid: "inv_" + Math.random().toString(16).slice(2) + "_" + Date.now(),
    giftId: gift.id || "",
    emoji: gift.emoji || "üéÅ",
    name: gift.name || "–ü–æ–¥–∞—Ä–æ–∫",
    cost: Number(gift.cost || 0),
    fromCase: caseObj.name || "",
    ts: nowMs(),
  };
  inventory.unshift(item);
  saveInventory();
}
function renderInventory(){
  if (!inventory.length){
    els.invWrap.innerHTML = `<div class="empty">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ–π –ø–æ–¥–∞—Ä–æ–∫ –∏ –Ω–∞–∂–º–∏ ‚Äú–û—Å—Ç–∞–≤–∏—Ç—å‚Äù.</div>`;
    return;
  }

  els.invWrap.innerHTML = `
    <div class="invList">
      ${inventory.map(it => `
        <div class="invItem" data-uid="${escapeHtml(it.uid)}">
          <div class="invLeft">
            <div class="miniEmoji">${escapeHtml(it.emoji)}</div>
            <div style="min-width:0;">
              <div class="invName">${escapeHtml(it.name)}</div>
              <div class="invMeta">–ò–∑: ${escapeHtml(it.fromCase)} ‚Ä¢ ${new Date(it.ts).toLocaleString()}</div>
            </div>
          </div>

          <div class="invRight">
            <div class="smallPrice" title="–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–∞—Ä–∫–∞">
              <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
              <span>${it.cost}</span>
            </div>
            <div class="smallPrice" title="–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏">
              <img class="starImg" src="img/Star.png" alt="‚≠ê" onerror="this.style.display='none'">
              <span>${sellItemValue(it.cost)}</span>
            </div>
            <button class="btn" data-sell="${escapeHtml(it.uid)}">–ü—Ä–æ–¥–∞—Ç—å</button>
          </div>
        </div>
      `).join("")}
    </div>
  `;

  els.invWrap.querySelectorAll("button[data-sell]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const uid = btn.getAttribute("data-sell");
      const idx = inventory.findIndex(x=>x.uid===uid);
      if (idx < 0) return;
      const it = inventory[idx];
      const gain = sellItemValue(it.cost);

      inventory.splice(idx, 1);
      saveInventory();

      stars += gain;
      earned += gain;
      saveEarned();

      saveBalance();
      updateStarsUI();
      renderInventory();
      alert(`–ü—Ä–æ–¥–∞–Ω–æ: +${gain} ‚≠ê`);
      // –æ–±–Ω–æ–≤–∏–º –ø–æ–¥–ø–∏—Å—å –≤ —à–∞–ø–∫–µ
      document.getElementById("subTitle").textContent = `${USER.username ? USER.username + " ‚Ä¢ " : ""}${earned} –∑–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ`;
    });
  });
}

/* ==========================
   SPIN
   –í–ê–ñ–ù–û: –µ—Å–ª–∏ –≤—ã–ø–∞–ª–∏ ‚≠ê (isStars:true) ‚Äî —Å—Ä–∞–∑—É –Ω–∞—á–∏—Å–ª—è–µ–º –Ω–∞ –±–∞–ª–∞–Ω—Å
========================== */
async function spin({demo=false} = {}){
  if (isSpinning) return;

  if (!demo){
    if (!canSpinNow()){
      updateCooldownUI();
      return;
    }
    const price = Number(activeCase.price) || 0;
    if (stars < price){
      els.resultText.textContent = "–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–≤—ë–∑–¥";
      els.resultMeta.textContent = `–ù—É–∂–Ω–æ: ${price}`;
      return;
    }
  }

  isSpinning = true;
  els.spinBtn.disabled = true;
  els.demoBtn.disabled = true;

  if (!demo){
    const price = Number(activeCase.price) || 0;
    stars = stars - price;
    saveBalance();
    updateStarsUI();
  }

  const base = activeCase.gifts;
  const picked = weightedPick(base);
  const baseIndex = picked.index;

  const repeats = Number(els.track.dataset.repeats || 18);
  const targetRepeat = repeats - 3;
  const targetIndexLong = targetRepeat * base.length + baseIndex;

  const rect = els.window.getBoundingClientRect();
  const centerX = rect.width / 2;

  const ITEM_W = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--itemW')) || 150;
  const itemCenterX = targetIndexLong * ITEM_W + ITEM_W / 2;
  const targetTranslate = centerX - itemCenterX;

  const from = getCurrentTranslateX();
  const duration = 2400 + Math.random()*700;
  const jitter = (Math.random()*12) - 6;
  const finalTranslate = targetTranslate + jitter;

  await animate(duration, (t)=>{
    const eased = easeOutCubic(t);
    const x = from + (finalTranslate - from) * eased;
    els.track.style.transform = `translateX(${x}px)`;
  });

  els.track.style.transform = `translateX(${targetTranslate}px)`;

  els.resultText.textContent = `${picked.gift.emoji} ${picked.gift.name}`;
  els.resultMeta.textContent = demo ? "–¥–µ–º–æ" : "—Å–ø–∏–Ω";

  if (!demo){
    setLastSpinMs(nowMs());
    updateCooldownUI();

    // ‚≠ê –≤—ã–ø–∞–ª–∏ ‚Äî —Å—Ä–∞–∑—É –Ω–∞—á–∏—Å–ª—è–µ–º, –±–µ–∑ –º–æ–¥–∞–ª–∫–∏
    if (picked.gift && picked.gift.isStars){
      const gainStars = Math.max(1, Number(picked.gift.cost || 0));
      stars += gainStars;
      earned += gainStars;
      saveEarned();
      saveBalance();
      updateStarsUI();
      alert(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: +${gainStars} ‚≠ê`);
      document.getElementById("subTitle").textContent = `${USER.username ? USER.username + " ‚Ä¢ " : ""}${earned} –∑–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ`;
    } else {
      openModal(picked.gift, activeCase);
    }
  }

  isSpinning = false;
  els.demoBtn.disabled = false;
}

/* –∫–Ω–æ–ø–∫–∏ */
els.spinBtn.addEventListener("click", ()=> spin({demo:false}));
els.demoBtn.addEventListener("click", ()=> spin({demo:true}));

/* –ú–æ–¥–∞–ª–∫–∞: –æ—Å—Ç–∞–≤–∏—Ç—å/–ø—Ä–æ–¥–∞—Ç—å */
els.keepBtn.addEventListener("click", ()=>{
  if (!pendingGift) return;
  addToInventory(pendingGift.gift, pendingGift.caseObj);
  closeModal();
  alert("–ü–æ–¥–∞—Ä–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –ø—Ä–æ—Ñ–∏–ª–µ ‚úÖ");
});
els.sellBtn.addEventListener("click", ()=>{
  if (!pendingGift) return;
  const gain = sellItemValue(pendingGift.gift.cost || 0);

  stars += gain;
  earned += gain;
  saveEarned();

  saveBalance();
  updateStarsUI();
  closeModal();
  alert(`–ü—Ä–æ–¥–∞–Ω–æ: +${gain} ‚≠ê`);
  document.getElementById("subTitle").textContent = `${USER.username ? USER.username + " ‚Ä¢ " : ""}${earned} –∑–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ`;
});

/* –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Ñ–∏–ª—è */
function exportJSON(){
  const data = {
    user: USER,
    stars,
    earned,
    inventory,
    lastSpinMs: getLastSpinMs(),
    exportedAt: new Date().toISOString()
  };
  const txt = JSON.stringify(data, null, 2);
  prompt("–°–∫–æ–ø–∏—Ä—É–π —ç–∫—Å–ø–æ—Ä—Ç JSON:", txt);
}
els.exportBtn.addEventListener("click", exportJSON);

/* –°–±—Ä–æ—Å –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö */
function wipeLocal(){
  const ok = confirm("–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å? (—É–¥–∞–ª–∏—Ç –∑–≤—ë–∑–¥—ã/–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å/–∫–¥ –ª–æ–∫–∞–ª—å–Ω–æ)");
  if (!ok) return;
  localStorage.removeItem(kBalance());
  localStorage.removeItem(kInv());
  localStorage.removeItem(kLastSpin());
  localStorage.removeItem(kEarned());
  loadAll();
  renderInventory();
  updateCooldownUI();
  alert("–°–±—Ä–æ—à–µ–Ω–æ.");
  document.getElementById("subTitle").textContent = `${USER.username ? USER.username + " ‚Ä¢ " : ""}${earned} –∑–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ`;
}
els.wipeBtn.addEventListener("click", wipeLocal);

/* ==========================
   –ü–õ–Æ–° –ö–ù–û–ü–ö–ê (–±–µ–∑ —á–∏—Ç–æ–≤)
   - –æ–±—ã—á–Ω—ã–º: –∑–∞–≥–ª—É—à–∫–∞
   - –∞–¥–º–∏–Ω: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü—É
========================== */
els.plusBtn.addEventListener("click", ()=>{
  if (!IS_ADMIN){
    alert("–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.");
    return;
  }
  setPage("admin");
});

/* ==========================
   ADMIN PANEL (@RealZanT)
========================== */
function ensureAdminVisibility(){
  // –µ—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω ‚Äî –≤–æ–æ–±—â–µ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∞ –∏–∑ DOM –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  if (!IS_ADMIN){
    const p = document.getElementById("page_admin");
    if (p) p.style.display = "none";
    return;
  }

  // –¥–æ–±–∞–≤–∏–º 6-—é –∫–Ω–æ–ø–∫—É –≤ –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é –Ω–µ –±—É–¥–µ–º (—á—Ç–æ–±—ã —Å–µ—Ç–∫–∞ –Ω–µ –ª–æ–º–∞–ª–∞—Å—å),
  // –∞–¥–º–∏–Ω –∑–∞—Ö–æ–¥–∏—Ç –ø–æ –∫–Ω–æ–ø–∫–µ "+" —Å–≤–µ—Ä—Ö—É.
  els.plusBtn.title = "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å";
}

if (els.adminApplyStars){
  els.adminApplyStars.addEventListener("click", ()=>{
    if (!IS_ADMIN) return;
    const v = Number(els.adminSetStars.value);
    if (!Number.isFinite(v) || v < 0) return alert("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ >= 0");
    stars = Math.floor(v);
    saveBalance();
    updateStarsUI();
    alert("–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—ë–Ω ‚úÖ");
  });

  els.adminAdd10.addEventListener("click", ()=>{
    if (!IS_ADMIN) return;
    stars += 10;
    saveBalance();
    updateStarsUI();
    alert("+10 ‚≠ê");
  });

  els.adminResetCd.addEventListener("click", ()=>{
    if (!IS_ADMIN) return;
    setLastSpinMs(0);
    updateCooldownUI();
    alert("–ö–î —Å–±—Ä–æ—à–µ–Ω ‚úÖ");
  });

  els.adminWipeAll.addEventListener("click", ()=>{
    if (!IS_ADMIN) return;
    const ok = confirm("–°—Ç–µ—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ —é–∑–µ—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é?");
    if (!ok) return;
    wipeLocal();
  });

  els.adminExport.addEventListener("click", ()=>{
    if (!IS_ADMIN) return;
    exportJSON();
  });
}

/* ==========================
   INIT
========================== */
loadAll();     // —Å–Ω–∞—á–∞–ª–∞ –¥–∞–Ω–Ω—ã–µ (earned —Ç–æ–∂–µ)
initUser();    // –ø–æ—Ç–æ–º user (–¥–ª—è –ø–æ–¥–ø–∏—Å–∏)
ensureAdminVisibility();

renderCases();
refreshRoulette();
updateCooldownUI();
renderInventory();

</script>
</body>
</html>
